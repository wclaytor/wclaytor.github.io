<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Ccircle cx='96' cy='96' r='80' fill='%233b82f6'/%3E%3Cpath d='M96 40 L140 90 L115 90 L115 120 L77 120 L77 90 L52 90 Z' fill='white'/%3E%3C/svg%3E" sizes="any" type="image/svg+xml">
    <title>Wave Maker</title>
    
    <!-- Alpine.js for reactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                darkMode: 'class'
            }
        }
    </script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        [x-cloak] { display: none !important; }
        
        /* Dark mode transitions */
        * {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
    </style>
</head>
<body>
    <div x-data="newWavesApp()" x-cloak :class="darkMode ? 'dark' : ''" class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-md transition-colors duration-300">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="bi bi-wave text-blue-500 text-3xl"></i>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100">
                                Wave Maker
                            </h1>
                            <p class="text-sm text-gray-600 dark:text-gray-300"></p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <button 
                            @click="exportImage()"
                            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-2 transition-colors duration-300">
                            <i class="bi bi-download"></i>
                            <span class="hidden sm:inline">Export</span>
                        </button>
                        <button 
                            @click="toggleDarkMode()"
                            class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300 transition-all duration-200"
                            title="Toggle dark mode">
                            <i x-show="!darkMode" class="bi bi-moon text-xl"></i>
                            <i x-show="darkMode" class="bi bi-sun text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

<!-- 
Hough Wave Generator - Interactive wave visualization tool
Features:
- Real-time canvas-based wave rendering
- Multiple wave layers with independent controls
- Preset wave configurations (Warm, Cool, Ocean themes)
- Adjustable frequency, amplitude, phase, and color
- Export to PNG
- Dark mode support
Uses: Alpine.js, Tailwind CSS, HTML5 Canvas
-->

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-6 py-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Canvas Area -->
                <div class="lg:col-span-2">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 transition-colors duration-300">
                        <canvas 
                            x-ref="canvas"
                            class="w-full border-2 border-gray-200 dark:border-gray-700 rounded-lg"
                            style="aspect-ratio: 16/9; max-height: 70vh;">
                        </canvas>
                    </div>
                </div>

                <!-- Controls Panel -->
                <div class="space-y-4">
                    <!-- Presets -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 transition-colors duration-300">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-3 flex items-center gap-2">
                            <i class="bi bi-palette"></i>
                            Presets
                        </h3>
                        <div class="grid grid-cols-3 gap-2">
                            <button 
                                @click="loadPreset('warm')"
                                class="px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200"
                                :class="currentPreset === 'warm' ? 'bg-amber-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'">
                                Warm
                            </button>
                            <button 
                                @click="loadPreset('cool')"
                                class="px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200"
                                :class="currentPreset === 'cool' ? 'bg-green-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'">
                                Cool
                            </button>
                            <button 
                                @click="loadPreset('ocean')"
                                class="px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200"
                                :class="currentPreset === 'ocean' ? 'bg-blue-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'">
                                Ocean
                            </button>
                        </div>
                    </div>

                    <!-- Wave Layers -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 transition-colors duration-300 max-h-[calc(100vh-300px)] overflow-y-auto">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2">
                                <i class="bi bi-layers"></i>
                                Wave Layers
                            </h3>
                            <button 
                                @click="addWaveLayer()"
                                :disabled="waves.length >= 8"
                                class="px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">
                                <i class="bi bi-plus-lg"></i>
                            </button>
                        </div>

                        <template x-for="(wave, index) in waves" :key="index">
                            <div class="mb-4 p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-700/50 transition-colors duration-300">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="'Wave ' + (index + 1)"></span>
                                    <button 
                                        @click="removeWaveLayer(index)"
                                        :disabled="waves.length <= 1"
                                        class="text-red-500 hover:text-red-700 disabled:opacity-30 disabled:cursor-not-allowed transition-colors duration-200"
                                        title="Remove layer">
                                        <i class="bi bi-x-lg"></i>
                                    </button>
                                </div>

                                <!-- Color -->
                                <div class="mb-2">
                                    <label class="text-xs text-gray-600 dark:text-gray-400 block mb-1">Color</label>
                                    <input 
                                        type="color" 
                                        x-model="wave.color"
                                        @input="render()"
                                        class="w-full h-8 rounded border border-gray-300 dark:border-gray-600 cursor-pointer">
                                </div>

                                <!-- Frequency -->
                                <div class="mb-2">
                                    <label class="text-xs text-gray-600 dark:text-gray-400 flex justify-between">
                                        <span>Frequency</span>
                                        <span x-text="wave.frequency.toFixed(2)"></span>
                                    </label>
                                    <input 
                                        type="range" 
                                        x-model.number="wave.frequency"
                                        @input="render()"
                                        min="0.5" 
                                        max="5" 
                                        step="0.1"
                                        class="w-full">
                                </div>

                                <!-- Amplitude -->
                                <div class="mb-2">
                                    <label class="text-xs text-gray-600 dark:text-gray-400 flex justify-between">
                                        <span>Amplitude</span>
                                        <span x-text="Math.round(wave.amplitude)"></span>
                                    </label>
                                    <input 
                                        type="range" 
                                        x-model.number="wave.amplitude"
                                        @input="render()"
                                        min="10" 
                                        max="150" 
                                        step="5"
                                        class="w-full">
                                </div>

                                <!-- Phase -->
                                <div class="mb-2">
                                    <label class="text-xs text-gray-600 dark:text-gray-400 flex justify-between">
                                        <span>Phase</span>
                                        <span x-text="wave.phase.toFixed(1)"></span>
                                    </label>
                                    <input 
                                        type="range" 
                                        x-model.number="wave.phase"
                                        @input="render()"
                                        min="0" 
                                        max="6.28" 
                                        step="0.1"
                                        class="w-full">
                                </div>

                                <!-- Opacity -->
                                <div class="mb-2">
                                    <label class="text-xs text-gray-600 dark:text-gray-400 flex justify-between">
                                        <span>Opacity</span>
                                        <span x-text="(wave.opacity * 100).toFixed(0) + '%'"></span>
                                    </label>
                                    <input 
                                        type="range" 
                                        x-model.number="wave.opacity"
                                        @input="render()"
                                        min="0.1" 
                                        max="1" 
                                        step="0.05"
                                        class="w-full">
                                </div>

                                <!-- Line Width -->
                                <div>
                                    <label class="text-xs text-gray-600 dark:text-gray-400 flex justify-between">
                                        <span>Line Width</span>
                                        <span x-text="wave.lineWidth"></span>
                                    </label>
                                    <input 
                                        type="range" 
                                        x-model.number="wave.lineWidth"
                                        @input="render()"
                                        min="1" 
                                        max="10" 
                                        step="1"
                                        class="w-full">
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        function newWavesApp() {
            return {
                // === STATE ===
                darkMode: false,
                currentPreset: 'warm',
                waves: [],
                
                // === LIFECYCLE ===
                init() {
                    // Load dark mode preference
                    const savedDarkMode = localStorage.getItem('new-waves-darkMode');
                    this.darkMode = savedDarkMode === 'true';
                    this.updateDarkMode();
                    
                    // Load default preset
                    this.loadPreset('warm');
                    
                    // Initial render after Alpine is ready
                    this.$nextTick(() => {
                        this.setupCanvas();
                        this.render();
                    });
                    
                    // Re-render on window resize
                    window.addEventListener('resize', () => this.render());
                },

                // === METHODS ===
                setupCanvas() {
                    const canvas = this.$refs.canvas;
                    const rect = canvas.getBoundingClientRect();
                    canvas.width = rect.width * 2; // 2x for retina
                    canvas.height = rect.height * 2;
                    const ctx = canvas.getContext('2d');
                    ctx.scale(2, 2);
                },

                render() {
                    const canvas = this.$refs.canvas;
                    if (!canvas) return;
                    
                    const ctx = canvas.getContext('2d');
                    const width = canvas.width / 2;
                    const height = canvas.height / 2;
                    
                    // Clear canvas with background
                    ctx.fillStyle = this.darkMode ? '#111827' : '#ffffff';
                    ctx.fillRect(0, 0, width, height);
                    
                    // Draw each wave
                    this.waves.forEach(wave => {
                        this.drawWave(ctx, width, height, wave);
                    });
                },

                drawWave(ctx, width, height, wave) {
                    const centerY = height / 2;
                    const points = 500; // Number of points to calculate
                    
                    ctx.save();
                    ctx.beginPath();
                    ctx.strokeStyle = this.hexToRGBA(wave.color, wave.opacity);
                    ctx.lineWidth = wave.lineWidth;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    
                    // Calculate wave points
                    for (let i = 0; i <= points; i++) {
                        const x = (i / points) * width;
                        const t = (i / points) * Math.PI * 2 * wave.frequency;
                        const y = centerY + Math.sin(t + wave.phase) * wave.amplitude;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    
                    ctx.stroke();
                    ctx.restore();
                },

                hexToRGBA(hex, alpha) {
                    const r = parseInt(hex.slice(1, 3), 16);
                    const g = parseInt(hex.slice(3, 5), 16);
                    const b = parseInt(hex.slice(5, 7), 16);
                    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
                },

                loadPreset(preset) {
                    this.currentPreset = preset;
                    
                    const presets = {
                        warm: [
                            { color: '#d97706', frequency: 1.5, amplitude: 60, phase: 0, opacity: 0.7, lineWidth: 3 },
                            { color: '#ea580c', frequency: 2.2, amplitude: 45, phase: 1.5, opacity: 0.6, lineWidth: 2 },
                            { color: '#f59e0b', frequency: 1.8, amplitude: 35, phase: 3, opacity: 0.5, lineWidth: 2 }
                        ],
                        cool: [
                            { color: '#059669', frequency: 1.2, amplitude: 70, phase: 0, opacity: 0.7, lineWidth: 3 },
                            { color: '#10b981', frequency: 2.5, amplitude: 50, phase: 2, opacity: 0.6, lineWidth: 2 },
                            { color: '#34d399', frequency: 1.7, amplitude: 40, phase: 4, opacity: 0.5, lineWidth: 2 }
                        ],
                        ocean: [
                            { color: '#0284c7', frequency: 1.3, amplitude: 65, phase: 0, opacity: 0.7, lineWidth: 3 },
                            { color: '#0ea5e9', frequency: 2.1, amplitude: 55, phase: 1.8, opacity: 0.6, lineWidth: 2 },
                            { color: '#38bdf8', frequency: 1.6, amplitude: 42, phase: 3.5, opacity: 0.5, lineWidth: 2 }
                        ]
                    };
                    
                    this.waves = presets[preset];
                    this.$nextTick(() => this.render());
                },

                addWaveLayer() {
                    if (this.waves.length >= 8) return;
                    
                    this.waves.push({
                        color: '#6366f1',
                        frequency: 2,
                        amplitude: 50,
                        phase: 0,
                        opacity: 0.6,
                        lineWidth: 2
                    });
                    this.render();
                },

                removeWaveLayer(index) {
                    if (this.waves.length <= 1) return;
                    this.waves.splice(index, 1);
                    this.render();
                },

                exportImage() {
                    const canvas = this.$refs.canvas;
                    const link = document.createElement('a');
                    link.download = `hough-wave-${Date.now()}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                },

                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    this.updateDarkMode();
                    localStorage.setItem('new-waves-darkMode', this.darkMode.toString());
                    this.render(); // Re-render with new background
                },

                updateDarkMode() {
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
            }
        }
    </script>
    <!-- PWA Functionality -->
    <script>
        // Listen for PWA install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA Install prompt available!');
            // Optionally, you can store the event and show a custom install button
            // e.preventDefault();
            // window.deferredPrompt = e;
        });

        const iconSize = 192;

        // Dynamically created manifest
        const manifest = {
            name: 'Wave Maker',
            short_name: 'Wave Maker',
            display: 'standalone',
            theme_color: '#3b82f6',
            background_color: '#f9fafb',
            start_url: window.location.href,
            // PNG icon will be converted from SVG
        };

        // Convert the SVG favicon to PNG for platforms that don't support SVG
        // (Safari and Firefox on Android)
        (async function() {
            const svgIconLink = document.querySelector('link[rel="icon"]');

            // Convert from SVG string to PNG data URL
            const pngDataUrl = await svgToPng(svgIconLink.href, iconSize);

            // Set the icon meta tags to the new PNG
            setIcon("link[rel='icon']", pngDataUrl, iconSize);
            setIcon("link[rel='apple-touch-icon']", pngDataUrl);

            // Dynamically create manifest
            manifest.icons = [{
                src: pngDataUrl,
                sizes: `${iconSize}x${iconSize}`,
                type: 'image/png'
            }];

            // Set the manifest meta tag data url
            setManifest(manifest);

            // Generate and set the iOS startup image
            const startupImageDataUrl = await createStartupImage(
                svgIconLink.href,
                manifest.background_color
            );
            const startupLink = document.createElement('link');
            startupLink.rel = 'apple-touch-startup-image';
            startupLink.href = startupImageDataUrl;
            document.head.appendChild(startupLink);
        })();

        function setManifest(manifest) {
            const link = document.createElement('link');
            link.rel = 'manifest';
            const b64manifest = btoa(JSON.stringify(manifest));
            link.href = "data:application/json;base64," + b64manifest;
            document.head.appendChild(link);
        }

        function setIcon(query, iconurl, size) {
            const iconLink = document.querySelector(query);
            iconLink.href = iconurl;
            iconLink.type = 'image/png';
            if (size) {
                iconLink.setAttribute('sizes', `${size}x${size}`);
            }
        }

        function svgToPng(svgDataUrl, size) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = size;
                    canvas.height = size;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, size, size);
                    const pngDataUrl = canvas.toDataURL('image/png');
                    resolve(pngDataUrl);
                };
                img.onerror = reject;
                img.src = svgDataUrl;
            });
        }

        // Safari needs a startup image
        function createStartupImage(svgDataUrl, bgColor) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    const dpr = window.devicePixelRatio || 1;
                    const canvas = document.createElement('canvas');
                    canvas.width = window.screen.width * dpr;
                    canvas.height = window.screen.height * dpr;
                    const ctx = canvas.getContext('2d');

                    ctx.fillStyle = bgColor;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    const iconDisplaySize = canvas.width * 0.25;
                    const x = (canvas.width - iconDisplaySize) / 2;
                    const y = (canvas.height - iconDisplaySize) / 2;
                    ctx.drawImage(img, x, y, iconDisplaySize, iconDisplaySize);

                    resolve(canvas.toDataURL('image/png'));
                };
                img.onerror = reject;
                img.src = svgDataUrl;
            });
        }
    </script>
</body>
</html>