<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>__TITLE__</title>
  <style>
    /* ====== Reset / base ====== */
    *,*::before,*::after{box-sizing:border-box}
    html{scroll-behavior:smooth}
    @media (prefers-reduced-motion: reduce){html{scroll-behavior:auto}}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      line-height:1.55;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased}
    a{color:inherit}
    :focus{outline:none}
    :focus-visible{outline:3px solid currentColor; outline-offset:3px; border-radius:10px}

    /* ====== Theme ====== */
    :root{
      --bg:#ffffff;
      --fg:#0b1220;
      --muted:#5a6475;
      --card:#f5f7fb;
      --border:rgba(11,18,32,.12);
      --shadow:0 10px 30px rgba(11,18,32,.12);
      --accent:#2563eb;
      --accent2:#7c3aed;
      --mark-bg:rgba(37,99,235,.16);
      --kbd-bg:rgba(11,18,32,.08);
    }
    [data-theme="dark"]{
      --bg:#0b1220;
      --fg:#eef2ff;
      --muted:#a6b0c3;
      --card:#121b2f;
      --border:rgba(238,242,255,.14);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --accent:#60a5fa;
      --accent2:#a78bfa;
      --mark-bg:rgba(96,165,250,.18);
      --kbd-bg:rgba(238,242,255,.12);
    }

    /* ====== Layout ====== */
    body{background:var(--bg); color:var(--fg)}
    .skip{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip:focus{left:16px;top:16px;width:auto;height:auto;z-index:1000;background:var(--bg);color:var(--fg);
      padding:10px 14px;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow)}
    .shell{display:grid;grid-template-columns:320px 1fr;min-height:100vh}
    nav{position:sticky;top:0;height:100vh;padding:18px 14px;border-right:1px solid var(--border);background:linear-gradient(180deg,var(--card),transparent 60%)}
    main{padding:28px 24px 60px;max-width:980px}
    .brand{display:flex;flex-direction:column;gap:8px;padding:12px;border-radius:18px;background:var(--card);border:1px solid var(--border);box-shadow:var(--shadow)}
    .name{font-size:1.25rem;font-weight:800;letter-spacing:-0.02em}
    .meta{color:var(--muted);font-size:.95rem}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{appearance:none;border:1px solid var(--border);background:var(--bg);color:var(--fg);padding:10px 12px;border-radius:14px;
      box-shadow:0 6px 16px rgba(0,0,0,.06);cursor:pointer;font-weight:650}
    .btn:hover{transform:translateY(-1px)}
    @media (prefers-reduced-motion: reduce){.btn:hover{transform:none}}
    .btn[aria-pressed="true"]{border-color:rgba(37,99,235,.45); box-shadow:0 0 0 3px rgba(37,99,235,.15)}
    .search{display:flex;gap:10px;align-items:center;flex:1 1 220px}
    .search input{width:100%;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:var(--bg);color:var(--fg)}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.85rem;background:var(--kbd-bg);
      padding:3px 7px;border-radius:8px;color:var(--muted);border:1px solid var(--border)}
    .navlinks{margin-top:16px;display:flex;flex-direction:column;gap:6px}
    .navlinks a{display:flex;justify-content:space-between;gap:10px;text-decoration:none;padding:10px 12px;border-radius:14px;border:1px solid transparent;color:var(--muted)}
    .navlinks a:hover{border-color:var(--border);background:rgba(127,127,127,.06);color:var(--fg)}
    .navlinks a[aria-current="true"]{background:rgba(37,99,235,.10);border-color:rgba(37,99,235,.25);color:var(--fg)}
    .pill{font-size:.75rem;color:var(--muted);border:1px solid var(--border);padding:2px 8px;border-radius:999px}
    .mobilebar{display:none;position:sticky;top:0;z-index:999;background:rgba(0,0,0,0);backdrop-filter:saturate(120%) blur(10px)}
    .mobilebar .inner{display:flex;gap:10px;align-items:center;padding:10px 12px;border-bottom:1px solid var(--border);
      background:color-mix(in oklab, var(--bg) 92%, transparent)}
    .drawer{display:none;padding:12px;border-bottom:1px solid var(--border);background:var(--bg)}
    .drawer.open{display:block}
    .drawer .navlinks{margin-top:0}
    @media (max-width: 940px){
      .shell{grid-template-columns:1fr}
      nav{display:none}
      .mobilebar{display:block}
      main{padding:18px 14px 52px}
    }

    /* ====== Content ====== */
    section{margin:26px 0}
    h2{font-size:1.25rem;margin:0 0 12px 0;letter-spacing:-0.02em}
    h3{font-size:1.05rem;margin:18px 0 6px;letter-spacing:-0.01em}
    p{margin:10px 0;color:var(--fg)}
    ul{margin:10px 0 10px 20px}
    li{margin:6px 0}
    .card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:16px 16px;box-shadow:var(--shadow)}

    /* Header card */
    .pagehead{margin:0 0 14px}
    .headcard{padding:18px 18px}
    .headgrid{display:flex;flex-wrap:wrap;gap:14px;align-items:flex-start;justify-content:space-between}
    .h1{margin:0;font-size:clamp(26px, 3.2vw, 40px);letter-spacing:-0.02em;line-height:1.08}
    .contact{margin-top:8px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;color:var(--muted);font-weight:650}
    .contact a{color:inherit}
    .dot{opacity:.65}
    .headlinks{display:flex;flex-wrap:wrap;gap:8px;justify-content:flex-end}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,0.02);text-decoration:none;color:var(--fg);font-weight:750}
    .pill:hover{box-shadow:0 0 0 4px var(--ring);outline:none}
    @media (max-width: 720px){
      .headlinks{justify-content:flex-start}
    }

    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:baseline}
    .row .right{margin-left:auto;color:var(--muted);font-weight:650}
    .small{color:var(--muted);font-size:.95rem}
    .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .tag{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(127,127,127,.06);color:var(--muted);font-weight:650;font-size:.9rem}
    details{border:1px solid var(--border);border-radius:16px;padding:10px 12px;background:rgba(127,127,127,.05)}
    summary{cursor:pointer;font-weight:750}
    summary::-webkit-details-marker{display:none}
    summary::after{content:"▾";float:right;color:var(--muted)}
    details[open] summary::after{content:"▴"}
    mark{background:var(--mark-bg);color:inherit;padding:0 .15em;border-radius:.3em}

    /* ====== View switch animation ====== */
    .viewwrap{position:relative}
    .viewpanel{transition:opacity .22s ease, transform .22s ease; will-change:transform,opacity}
    .viewpanel.exit{opacity:0;transform:translateY(6px)}
    .viewpanel.enter{opacity:0;transform:translateY(-6px)}
    .viewpanel.enter.active{opacity:1;transform:translateY(0)}
    @media (prefers-reduced-motion: reduce){
      .viewpanel{transition:none}
    }

    /* ====== Print ====== */
    @media print{
      .mobilebar, nav, .toolbar, .drawer{display:none !important}
      main{max-width:none;padding:0}
      body{background:#fff;color:#000}
      .card, details{box-shadow:none}
      a{text-decoration:none}
      mark{background:transparent}
    }
  </style>
</head>
<body>
<a class="skip" href="#content">Skip to content</a>

<div class="mobilebar" role="banner">
  <div class="inner">
    <button class="btn" id="mobileMenuBtn" aria-expanded="false" aria-controls="mobileDrawer">Menu</button>
    <div style="font-weight:800;letter-spacing:-0.02em">__TITLE__</div>
    <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
      <button class="btn" id="themeBtnMobile" title="Toggle theme" aria-pressed="false">Theme</button>
    </div>
  </div>
  <div class="drawer" id="mobileDrawer"></div>
</div>

<div class="shell">
  <nav aria-label="Sections">
    <div class="brand">
      <div class="name" id="brandName">Navigation</div>
<div class="toolbar" aria-label="Toolbar">

        <div class="search" id="searchWrap">
          <input id="searchInput" type="search" placeholder="Search (press /)" aria-label="Search resume" />
          <span class="kbd">/</span>
        </div>

        <button class="btn" id="viewBtn" aria-pressed="true" title="Toggle short/full">Short</button>
        <button class="btn" id="themeBtn" aria-pressed="false" title="Toggle theme">Theme</button>
        <button class="btn" id="printBtn" title="Print / Save PDF">Print</button>
      </div>

      <div class="navlinks" id="navLinks"></div>
    </div>
  </nav>

  <main id="content" tabindex="-1">
    <header class="pagehead" id="pageHead" aria-label="Resume header"></header>
    <div class="viewwrap">
      <div class="viewpanel" id="viewPanel"></div>
    </div>
  </main>
</div>

<script>
/** ====== Embedded data ====== */
const RESUME = __DATA_JSON__;
const CONFIG = __CONFIG_JSON__;

/** ====== Helpers ====== */
const $ = (sel, el=document) => el.querySelector(sel);
const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

function slugify(s){
  return (s||'')
    .toLowerCase()
    .replace(/&/g,'and')
    .replace(/[^a-z0-9]+/g,'-')
    .replace(/(^-|-$)/g,'');
}

function setTheme(theme){
  // theme: 'light' | 'dark' | 'system'
  const root = document.documentElement;
  if(theme === 'system'){
    root.removeAttribute('data-theme');
  }else{
    root.setAttribute('data-theme', theme);
  }
  if(CONFIG.ui.rememberTheme){
    localStorage.setItem('resume_theme', theme);
  }
  syncThemeButtons(theme);
}

function getSystemTheme(){
  const dark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  return dark ? 'dark' : 'light';
}

function getInitialTheme(){
  const saved = CONFIG.ui.rememberTheme ? localStorage.getItem('resume_theme') : null;
  return saved || CONFIG.ui.defaultTheme || 'system';
}

function toggleTheme(){
  const cur = document.documentElement.getAttribute('data-theme') || 'system';
  // Cycle: system -> dark -> light -> system
  const next = (cur === 'system') ? 'dark' : (cur === 'dark' ? 'light' : 'system');
  setTheme(next);
}

function syncThemeButtons(theme){
  const label = theme === 'system' ? `Theme: Auto` : `Theme: ${theme[0].toUpperCase()+theme.slice(1)}`;
  const pressed = theme !== 'system';
  const btns = [$('#themeBtn'), $('#themeBtnMobile')].filter(Boolean);
  btns.forEach(b => { b.textContent = label; b.setAttribute('aria-pressed', pressed ? 'true' : 'false'); });
}

function setView(view){
  // view: 'short' | 'full'
  if(CONFIG.ui.rememberView){
    localStorage.setItem('resume_view', view);
  }
  renderWithTransition(view);
  syncViewButton(view);
}

function getInitialView(){
  const saved = CONFIG.ui.rememberView ? localStorage.getItem('resume_view') : null;
  return saved || CONFIG.ui.defaultView || 'short';
}

function syncViewButton(view){
  const btn = $('#viewBtn');
  if(!btn) return;
  const label = (view === 'short') ? 'Content: Short' : 'Content: Full';
  btn.textContent = label;
  btn.setAttribute('aria-pressed', 'true');
}

function scrollHome(){
  window.scrollTo({ top: 0, behavior: (CONFIG.ui.smoothScroll && !prefersReducedMotion) ? 'smooth' : 'auto' });
  const content = $('#content');
  if(content) content.focus({ preventScroll: true });
}

function escapeHtml(s){
  return (s||'')
    .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
    .replaceAll('"','&quot;').replaceAll("'",'&#39;');
}

function buildPageHeader(model){
  const name = escapeHtml(model.name || '');
  const location = escapeHtml(model.location || '');
  const email = escapeHtml(model.email || '');

  const contactParts = [];
  if(location) contactParts.push(`<span>${location}</span>`);
  if(email) contactParts.push(`<a href="mailto:${email}">${email}</a>`);

  return `
    <section class="card headcard" aria-labelledby="resumeName">
      <div class="headgrid">
        <div>
          <h1 id="resumeName" class="h1">${name}</h1>
          <div class="contact" aria-label="Contact information">${contactParts.join('<span class="dot" aria-hidden="true">•</span>')}</div>
        </div>
      </div>
    </section>
  `;
}


function highlight(text, q){
  if(!CONFIG.search.highlightMatches || !q || q.length < (CONFIG.search.minQueryLength||2)) return escapeHtml(text);
  const re = new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'ig');
  return escapeHtml(text).replace(re, '<mark>$1</mark>');
}

/** ====== Short view derivation ====== */
function buildShortModel(full){
  const out = JSON.parse(JSON.stringify(full)); // deep copy
  // Determine which sections to include
  const include = new Set((CONFIG.shortView.sections.include||[]).map(s => s.toLowerCase()));
  const exclude = new Set((CONFIG.shortView.sections.exclude||[]).map(s => s.toLowerCase()));
  out.sections = out.sections.filter(sec => {
    const name = (sec.title||'').toLowerCase();
    if(exclude.has(name)) return false;
    if(include.size && !include.has(name)) return false;
    return true;
  });

  // Work Experience trimming
  const we = out.sections.find(s => (s.title||'').toLowerCase() === 'work experience');
  if(we && Array.isArray(we.items)){
    const keepN = CONFIG.shortView.workExperience.jobsToKeep ?? 3;
    const keepB = CONFIG.shortView.workExperience.bulletsPerJob ?? 3;
    const kept = we.items.slice(0, keepN).map(job => {
      const j = {...job};
      if(Array.isArray(j.bullets)) j.bullets = j.bullets.slice(0, keepB);
      return j;
    });
    const dropped = we.items.slice(keepN);
    we.items = kept;

    if(CONFIG.shortView.earlierExperience?.enabled && dropped.length){
      const companies = dropped.map(d => d.company).filter(Boolean);
      const uniq = Array.from(new Set(companies));
      const maxC = CONFIG.shortView.earlierExperience.maxCompanies ?? 8;
      const shown = uniq.slice(0, maxC);
      const more = uniq.length > maxC ? ` +${uniq.length - maxC} more` : '';
      const label = CONFIG.shortView.earlierExperience.label || 'Earlier Experience';

      we.items.push({
        kind: 'earlier',
        role: label,
        company: shown.join(' • ') + more,
        location: '',
        dates: '',
        description: '',
        bullets: []
      });
    }
  }

  return out;
}

/** ====== Rendering ====== */
function render(model){
  // Sidebar title (keep minimal; main header shows full contact)
  $('#brandName').textContent = (CONFIG?.ui?.sidebarTitle) || 'Navigation';

  
  // Main page header (name + contact)
  $('#pageHead').innerHTML = buildPageHeader(model);

// Build sections + ids
  const sections = model.sections.map(sec => ({...sec, id: slugify(sec.title)}));

  // Nav
  if(CONFIG.ui.enableNav){
    const nav = $('#navLinks');
    nav.innerHTML = '';
    // Add Home link first
    const homeLink = document.createElement('a');
    homeLink.href = '#';
    homeLink.innerHTML = `<span>Home</span>`;
    homeLink.addEventListener('click', (e) => {
      e.preventDefault();
      scrollHome();
    });
    nav.appendChild(homeLink);
    // Then add section links
    sections.forEach(sec => {
      const a = document.createElement('a');
      a.href = `#${sec.id}`;
      a.innerHTML = `<span>${escapeHtml(sec.title)}</span>`;
      a.addEventListener('click', (e) => {
        // Let anchor work, but adjust focus after.
        setTimeout(() => {
          const el = document.getElementById(sec.id);
          if(el) el.focus({preventScroll:true});
        }, 0);
      });
      nav.appendChild(a);
    });
  }else{
    const nav = $('#navLinks');
    if(nav) nav.innerHTML = '';
  }

  // Mobile drawer
  const drawer = $('#mobileDrawer');
  drawer.innerHTML = '';
  const m = document.createElement('div');
  m.className = 'brand';
  m.style.boxShadow = 'none';
  m.style.border = '1px solid var(--border)';
  m.style.background = 'var(--card)';
  m.innerHTML = `
    <div class="name">${escapeHtml(model.name||'')}</div>
    <div class="meta">${escapeHtml([model.location, model.email].filter(Boolean).join(' · '))}</div>
    <div class="navlinks" id="mNav"></div>
  `;
  drawer.appendChild(m);
  const mNav = $('#mNav', drawer);
  if(CONFIG.ui.enableNav){
    // Add Home link first
    const homeLink = document.createElement('a');
    homeLink.href = '#';
    homeLink.innerHTML = `<span>Home</span>`;
    homeLink.addEventListener('click', (e) => {
      e.preventDefault();
      scrollHome();
      closeMobileDrawer();
    });
    mNav.appendChild(homeLink);
    // Then add section links
    sections.forEach(sec => {
      const a = document.createElement('a');
      a.href = `#${sec.id}`;
      a.innerHTML = `<span>${escapeHtml(sec.title)}</span>`;
      a.addEventListener('click', () => closeMobileDrawer());
      mNav.appendChild(a);
    });
  }

  // Content
  const panel = $('#viewPanel');
  panel.innerHTML = '';

  // Sections
  sections.forEach(sec => {
    const sEl = document.createElement('section');
    sEl.id = sec.id;
    sEl.tabIndex = -1;
    sEl.innerHTML = `<h2>${escapeHtml(sec.title)}</h2>`;
    if(sec.kind === 'text'){
      sEl.innerHTML += sec.html || '';
    }else if(sec.kind === 'work'){
      (sec.items||[]).forEach(job => {
        const card = document.createElement('div');
        card.className = 'card';
        const title = job.kind === 'earlier' ? escapeHtml(job.role||'Earlier Experience')
          : `${escapeHtml(job.role||'')}`;
        const company = escapeHtml(job.company||'');
        const loc = escapeHtml(job.location||'');
        const dates = escapeHtml(job.dates||'');
        const desc = job.description ? `<details ${CONFIG.ui.collapseCompanyDescriptionsByDefault ? '' : 'open'}>
            <summary>About ${company || 'this company'}</summary>
            <p class="small">${escapeHtml(job.description)}</p>
          </details>` : '';
        const bullets = (job.bullets||[]).length ? `<ul>${job.bullets.map(b => `<li>${b}</li>`).join('')}</ul>` : '';
        card.innerHTML = `
          <div class="row">
            <div>
              <div style="font-weight:850">${title}</div>
              <div class="small">${company}${(loc||dates) ? ` · ${loc}${(loc&&dates)?' · ':''}${dates}` : ''}</div>
            </div>
          </div>
          ${desc}
          ${bullets}
        `;
        sEl.appendChild(card);
        sEl.appendChild(document.createElement('div')).style.height = '10px';
      });
    }
    panel.appendChild(sEl);
  });

  // Setup intersection observer for aria-current
  if(CONFIG.ui.enableNav){
    const links = $$('#navLinks a');
    const map = new Map(links.map(a => [a.getAttribute('href').slice(1), a]));
    const obs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        const id = e.target.id;
        const a = map.get(id);
        if(!a) return;
        if(e.isIntersecting){
          links.forEach(x => x.setAttribute('aria-current','false'));
          a.setAttribute('aria-current','true');
        }
      });
    }, { rootMargin: '-30% 0px -60% 0px', threshold: 0.01 });
    sections.forEach(sec => {
      const el = document.getElementById(sec.id);
      if(el) obs.observe(el);
    });
  }
}

function renderWithTransition(view){
  const panel = $('#viewPanel');
  const current = panel;
  // exit
  current.classList.add('exit');
  const doRender = () => {
    current.classList.remove('exit');
    current.classList.add('enter');
    const model = (view === 'short') ? buildShortModel(RESUME) : RESUME;
    render(model);
    // enter
    requestAnimationFrame(() => {
      current.classList.add('active');
      setTimeout(() => {
        current.classList.remove('enter','active');
      }, prefersReducedMotion ? 0 : 240);
    });
  };
  setTimeout(doRender, prefersReducedMotion ? 0 : 180);
}

/** ====== Mobile drawer ====== */
function openMobileDrawer(){
  const btn = $('#mobileMenuBtn');
  const drawer = $('#mobileDrawer');
  drawer.classList.add('open');
  btn.setAttribute('aria-expanded','true');
}
function closeMobileDrawer(){
  const btn = $('#mobileMenuBtn');
  const drawer = $('#mobileDrawer');
  drawer.classList.remove('open');
  btn.setAttribute('aria-expanded','false');
}
function toggleMobileDrawer(){
  const drawer = $('#mobileDrawer');
  drawer.classList.contains('open') ? closeMobileDrawer() : openMobileDrawer();
}

/** ====== Wire up ====== */
(function init(){
  // Theme
  const initialTheme = getInitialTheme();
  setTheme(initialTheme);

  // UI toggles
  if(!CONFIG.ui.enableThemeToggle){
    ['#themeBtn','#themeBtnMobile'].forEach(id => { const el=$(id); if(el) el.style.display='none'; });
  }
  if(!CONFIG.ui.enableSearch){
    const sw = $('#searchWrap'); if(sw) sw.style.display='none';
  }
  if(!CONFIG.ui.enableViewToggle){
    const vb = $('#viewBtn'); if(vb) vb.style.display='none';
  }

  // View
  const initialView = getInitialView();
  syncViewButton(initialView);
  render((initialView === 'short') ? buildShortModel(RESUME) : RESUME);

  // Buttons
  $('#themeBtn')?.addEventListener('click', toggleTheme);
  $('#themeBtnMobile')?.addEventListener('click', toggleTheme);
  $('#printBtn')?.addEventListener('click', () => window.print());
  $('#viewBtn')?.addEventListener('click', () => {
    const cur = getInitialView();
    setView(cur === 'short' ? 'full' : 'short');
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if(e.key.toLowerCase() === 'p' && (e.ctrlKey || e.metaKey)){
      // let browser print
      return;
    }
    if(e.key.toLowerCase() === 'p' && !e.ctrlKey && !e.metaKey && !e.altKey){
      e.preventDefault(); window.print();
    }
    if(e.key.toLowerCase() === 'h' && !e.ctrlKey && !e.metaKey && !e.altKey){
      e.preventDefault(); scrollHome();
    }
  });

  // Mobile menu
  $('#mobileMenuBtn')?.addEventListener('click', toggleMobileDrawer);
})();
</script>
</body>
</html>
