<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>William Claytor</title>
  <style>
    /* ====== Reset / base ====== */
    *,*::before,*::after{box-sizing:border-box}
    html{scroll-behavior:smooth}
    @media (prefers-reduced-motion: reduce){html{scroll-behavior:auto}}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      line-height:1.55;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased}
    a{color:inherit}
    :focus{outline:none}
    :focus-visible{outline:3px solid currentColor; outline-offset:3px; border-radius:10px}

    /* ====== Theme ====== */
    :root{
      --bg:#ffffff;
      --fg:#0b1220;
      --muted:#5a6475;
      --card:#f5f7fb;
      --border:rgba(11,18,32,.12);
      --shadow:0 10px 30px rgba(11,18,32,.12);
      --accent:#2563eb;
      --accent2:#7c3aed;
      --mark-bg:rgba(37,99,235,.16);
      --kbd-bg:rgba(11,18,32,.08);
    }
    [data-theme="dark"]{
      --bg:#0b1220;
      --fg:#eef2ff;
      --muted:#a6b0c3;
      --card:#121b2f;
      --border:rgba(238,242,255,.14);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --accent:#60a5fa;
      --accent2:#a78bfa;
      --mark-bg:rgba(96,165,250,.18);
      --kbd-bg:rgba(238,242,255,.12);
    }

    /* ====== Layout ====== */
    body{background:var(--bg); color:var(--fg)}
    .skip{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
    .skip:focus{left:16px;top:16px;width:auto;height:auto;z-index:1000;background:var(--bg);color:var(--fg);
      padding:10px 14px;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow)}
    .shell{display:grid;grid-template-columns:320px 1fr;min-height:100vh}
    nav{position:sticky;top:0;height:100vh;padding:18px 14px;border-right:1px solid var(--border);background:linear-gradient(180deg,var(--card),transparent 60%)}
    main{padding:28px 24px 60px;max-width:980px}
    .brand{display:flex;flex-direction:column;gap:8px;padding:12px;border-radius:18px;background:var(--card);border:1px solid var(--border);box-shadow:var(--shadow)}
    .name{font-size:1.25rem;font-weight:800;letter-spacing:-0.02em}
    .meta{color:var(--muted);font-size:.95rem}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{appearance:none;border:1px solid var(--border);background:var(--bg);color:var(--fg);padding:10px 12px;border-radius:14px;
      box-shadow:0 6px 16px rgba(0,0,0,.06);cursor:pointer;font-weight:650}
    .btn:hover{transform:translateY(-1px)}
    @media (prefers-reduced-motion: reduce){.btn:hover{transform:none}}
    .btn[aria-pressed="true"]{border-color:rgba(37,99,235,.45); box-shadow:0 0 0 3px rgba(37,99,235,.15)}
    .search{display:flex;gap:10px;align-items:center;flex:1 1 220px}
    .search input{width:100%;padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:var(--bg);color:var(--fg)}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:.85rem;background:var(--kbd-bg);
      padding:3px 7px;border-radius:8px;color:var(--muted);border:1px solid var(--border)}
    .navlinks{margin-top:16px;display:flex;flex-direction:column;gap:6px}
    .navlinks a{display:flex;justify-content:space-between;gap:10px;text-decoration:none;padding:10px 12px;border-radius:14px;border:1px solid transparent;color:var(--muted)}
    .navlinks a:hover{border-color:var(--border);background:rgba(127,127,127,.06);color:var(--fg)}
    .navlinks a[aria-current="true"]{background:rgba(37,99,235,.10);border-color:rgba(37,99,235,.25);color:var(--fg)}
    .pill{font-size:.75rem;color:var(--muted);border:1px solid var(--border);padding:2px 8px;border-radius:999px}
    .mobilebar{display:none;position:sticky;top:0;z-index:999;background:rgba(0,0,0,0);backdrop-filter:saturate(120%) blur(10px)}
    .mobilebar .inner{display:flex;gap:10px;align-items:center;padding:10px 12px;border-bottom:1px solid var(--border);
      background:color-mix(in oklab, var(--bg) 92%, transparent)}
    .drawer{display:none;padding:12px;border-bottom:1px solid var(--border);background:var(--bg)}
    .drawer.open{display:block}
    .drawer .navlinks{margin-top:0}
    @media (max-width: 940px){
      .shell{grid-template-columns:1fr}
      nav{display:none}
      .mobilebar{display:block}
      main{padding:18px 14px 52px}
    }

    /* ====== Content ====== */
    section{margin:26px 0}
    h2{font-size:1.25rem;margin:0 0 12px 0;letter-spacing:-0.02em}
    h3{font-size:1.05rem;margin:18px 0 6px;letter-spacing:-0.01em}
    p{margin:10px 0;color:var(--fg)}
    ul{margin:10px 0 10px 20px}
    li{margin:6px 0}
    .card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:16px 16px;box-shadow:var(--shadow)}

    /* Header card */
    .pagehead{margin:0 0 14px}
    .headcard{padding:18px 18px}
    .headgrid{display:flex;flex-wrap:wrap;gap:14px;align-items:flex-start;justify-content:space-between}
    .h1{margin:0;font-size:clamp(26px, 3.2vw, 40px);letter-spacing:-0.02em;line-height:1.08}
    .contact{margin-top:8px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;color:var(--muted);font-weight:650}
    .contact a{color:inherit}
    .dot{opacity:.65}
    .headlinks{display:flex;flex-wrap:wrap;gap:8px;justify-content:flex-end}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,0.02);text-decoration:none;color:var(--fg);font-weight:750}
    .pill:hover{box-shadow:0 0 0 4px var(--ring);outline:none}
    @media (max-width: 720px){
      .headlinks{justify-content:flex-start}
    }

    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:baseline}
    .row .right{margin-left:auto;color:var(--muted);font-weight:650}
    .small{color:var(--muted);font-size:.95rem}
    .tags{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .tag{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(127,127,127,.06);color:var(--muted);font-weight:650;font-size:.9rem}
    details{border:1px solid var(--border);border-radius:16px;padding:10px 12px;background:rgba(127,127,127,.05)}
    summary{cursor:pointer;font-weight:750}
    summary::-webkit-details-marker{display:none}
    summary::after{content:"▾";float:right;color:var(--muted)}
    details[open] summary::after{content:"▴"}
    mark{background:var(--mark-bg);color:inherit;padding:0 .15em;border-radius:.3em}

    /* ====== View switch animation ====== */
    .viewwrap{position:relative}
    .viewpanel{transition:opacity .22s ease, transform .22s ease; will-change:transform,opacity}
    .viewpanel.exit{opacity:0;transform:translateY(6px)}
    .viewpanel.enter{opacity:0;transform:translateY(-6px)}
    .viewpanel.enter.active{opacity:1;transform:translateY(0)}
    @media (prefers-reduced-motion: reduce){
      .viewpanel{transition:none}
    }

    /* ====== Print ====== */
    @media print{
      .mobilebar, nav, .toolbar, .drawer{display:none !important}
      main{max-width:none;padding:0}
      body{background:#fff;color:#000}
      .card, details{box-shadow:none}
      a{text-decoration:none}
      mark{background:transparent}
    }
  </style>
</head>
<body>
<a class="skip" href="#content">Skip to content</a>

<div class="mobilebar" role="banner">
  <div class="inner">
    <button class="btn" id="mobileMenuBtn" aria-expanded="false" aria-controls="mobileDrawer">Menu</button>
    <div style="font-weight:800;letter-spacing:-0.02em">William Claytor</div>
    <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
      <button class="btn" id="themeBtnMobile" title="Toggle theme" aria-pressed="false">Theme</button>
    </div>
  </div>
  <div class="drawer" id="mobileDrawer"></div>
</div>

<div class="shell">
  <nav aria-label="Sections">
    <div class="brand">
      <div class="name" id="brandName">Navigation</div>
<div class="toolbar" aria-label="Toolbar">

        <div class="search" id="searchWrap">
          <input id="searchInput" type="search" placeholder="Search (press /)" aria-label="Search resume" />
          <span class="kbd">/</span>
        </div>

        <button class="btn" id="viewBtn" aria-pressed="true" title="Toggle short/full">Short</button>
        <button class="btn" id="themeBtn" aria-pressed="false" title="Toggle theme">Theme</button>
        <button class="btn" id="printBtn" title="Print / Save PDF">Print</button>
      </div>

      <div class="navlinks" id="navLinks"></div>
    </div>
  </nav>

  <main id="content" tabindex="-1">
    <header class="pagehead" id="pageHead" aria-label="Resume header"></header>
    <div class="viewwrap">
      <div class="viewpanel" id="viewPanel"></div>
    </div>
  </main>
</div>

<script>
/** ====== Embedded data ====== */
const RESUME = {"name": "William Claytor", "location": "Bel Air, MD | Tucson, AZ", "email": "claytor1@gmail.com", "links": [{"label": "Personal Website", "url": "https://wclaytor.github.io/"}, {"label": "GitHub", "url": "https://github.com/wclaytor"}, {"label": "LinkedIn", "url": "https://www.linkedin.com/in/billclaytor/"}], "sections": [{"title": "Links", "kind": "links", "html": "<ul><li>Personal Website — <a href=\"https://wclaytor.github.io/\" target=\"_blank\" rel=\"noopener noreferrer\">https://wclaytor.github.io/</a></li><li>GitHub — <a href=\"https://github.com/wclaytor\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/wclaytor</a></li><li>LinkedIn — <a href=\"https://www.linkedin.com/in/billclaytor/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.linkedin.com/in/billclaytor/</a></li></ul>", "items": []}, {"title": "Summary", "kind": "text", "html": "<p>Senior Quality Engineer and Automation Leader with 25+ years of experience transforming manual QA into scalable automated systems, currently pioneering AI-assisted QA workflows. Proven track record of building test frameworks, leading globally distributed teams, and embedding quality into CI/CD pipelines across SaaS, enterprise, and regulated environments.</p>", "items": []}, {"title": "Work Experience", "kind": "text", "html": "<h3>Senior Automation QA Engineer</h3>\n<div class=\"companyline\"><strong>insightsoftware</strong></div>\n<p>Remote 05/2023 – 12/2025</p>\n<p>insightsoftware is a global provider of reporting, analytics, and performance management solutions.</p>\n<div class=\"companyline\"><strong>Automation &amp; Innovation:</strong></div>\n<ul>\n<li>Pioneered AI-assisted QA workflow (GitHub Copilot + PowerShell) automating end-to-end Jira/Xray operations from requirements analysis through test execution and reporting</li>\n<li>Streamlined documentation by building an AI pipeline that converted legacy training videos into a searchable library using transcript analysis, automated screenshot extraction, and context-aware wiki generation</li>\n<li>Automated sprint release verification via Azure Pipelines using in-house C# / Selenium framework across multiple product lines</li>\n<li>Developed a test reporting dashboard tool for the automation triage process to quickly generate an HTML / email report with the daily Azure test results across multiple environments and releases, replacing the manual process and reducing report generation time from over 10 minutes to under 30 seconds</li>\n<li>Created an automated pipeline to extract 5000+ automated test cases from the legacy Team Foundation Server and generate corresponding test cases and test steps in Jira / Xray</li>\n<li>Coordinated test reporting across 7 globally distributed teams, establishing customer-facing delivery process for sanitized release reports</li>\n</ul>\n<div class=\"companyline\"><strong>Leadership &amp; Cross-Functional Initiatives:</strong></div>\n<ul>\n<li>Led distributed QA organization: coordinated with India-based co-lead, established processes across onshore/offshore teams, transitioned manual testers to automation</li>\n<li>Led disaster recovery testing for multiple products across global teams, coordinating with Production Support and Engineering through multiple DR iterations</li>\n<li>Founded Automation Guild community of practice; delivered monthly sessions on UI testing, performance testing, and automation best practices</li>\n<li>Established performance testing capability: led the initial development of the JMeter / Grafana framework and core test suite, helped to hire and onboard Principal Performance Engineer and Senior Performance Engineer</li>\n</ul>\n<p>---</p>\n<h3>Professional Development Sabbatical</h3>\n<p>08/2022 – 03/2023</p>\n<p>Sabbatical to develop and ship a production Rails app and evaluate modern test frameworks.</p>\n<ul>\n<li>Built and deployed Songbook (Rails, Dokku, DigitalOcean) - a setlist organizer for live music performance</li>\n<li>Evaluated Playwright and Cypress by building Page Object Model implementations for each</li>\n<li>Adopted GitHub Actions and GitHub Projects as CI/CD and project management alternatives to Jenkins / Jira</li>\n</ul>\n<p>---</p>\n<h3>Senior QA Engineer and QA Manager</h3>\n<div class=\"companyline\"><strong>Active911</strong></div>\n<p>Corvallis, OR 03/2020 – 07/2022</p>\n<p>Active911 helps heroes save lives with software designed to get first responders on scene faster with fast alerting, easy scheduling and more.</p>\n<div class=\"companyline\"><strong>Technical Leadership:</strong></div>\n<ul>\n<li>Established end-to-end QA coverage for ActiveAlert and ActiveTeam across web, Android, and iOS platforms throughout the full SDLC</li>\n<li>Architected Nightwatch.js test framework using Page Object Model; reusable module library accelerated new test development across the team</li>\n<li>Built real-time test automation dashboard integrating Jenkins Job DSL with TestRail API for live execution status and reporting</li>\n</ul>\n<div class=\"companyline\"><strong>Team Leadership:</strong></div>\n<ul>\n<li>Grew and developed QA team: led hiring, identified and promoted internal candidates from Customer Support, mentored team members in automation practices</li>\n<li>Embedded quality in development process by collaborating with product and engineering during backlog review and design sessions</li>\n<li>Coordinated UAT with product managers, ensuring customer requirements validated before releases</li>\n</ul>\n<p>---</p>\n<h3>Senior Software Engineer</h3>\n<div class=\"companyline\"><strong>Puppet</strong></div>\n<p>Portland, OR 01/2018 – 03/2020</p>\n<p>Puppet is the industry-leading automation solution for configuration management, compliance, CI/CD, patch management, IT automation, and more.</p>\n<div class=\"companyline\"><strong>Performance Engineering &amp; Framework Development:</strong></div>\n<ul>\n<li>Extended gatling-puppet-load-test (GPLT) framework with scale testing, automated HTML comparison reports, and system tuning integration with comprehensive RSpec unit test coverage</li>\n<li>Built Ruby provisioning utility for Puppet ABS API, enabling automated infrastructure node deployment with JSON request handling and YAML configuration export</li>\n<li>Contributed to Reference Architecture Setup (RAS) CLI tool using Ruby and Puppet Bolt; implemented Docker-based acceptance tests with comprehensive RSpec coverage</li>\n</ul>\n<div class=\"companyline\"><strong>Cross-Team Collaboration:</strong></div>\n<ul>\n<li>Drove performance testing standards through Reference Architectures Working Group, collaborating with Customer Success, Installer, and PuppetDB teams on architecture definition and test roadmap</li>\n<li>Served as Scrum Master for Installer and SLV teams, establishing Puppet Operating Model implementation and facilitating continuous process improvement</li>\n</ul>\n<p>---</p>\n<h3>Senior Quality Engineer</h3>\n<div class=\"companyline\"><strong>National Public Radio</strong></div>\n<p>Washington, DC 05/2014 – 01/2018</p>\n<p>NPR is an independent, nonprofit media organization that was founded on a mission to create a more informed public.</p>\n<div class=\"companyline\"><strong>Test Automation Architecture:</strong></div>\n<ul>\n<li>Led JavaScript framework evaluation across multiple teams; selected and implemented Nightwatch.js with cross-browser support integrated into Seamus CMS CI pipeline</li>\n<li>Architected hybrid test framework (keyword-driven + data-driven) in Java / Selenium serving cross-platform testing needs</li>\n<li>Built mobile testing capability using Appium for Android and iOS, establishing Jenkins-based infrastructure with simulators and emulators</li>\n</ul>\n<div class=\"companyline\"><strong>Developer Tooling &amp; Infrastructure:</strong></div>\n<ul>\n<li>Created test documentation web app using Node.js / Express backend with React / Redux frontend, improving test suite visibility across teams</li>\n<li>Established Jenkins automation dashboards using Job DSL across Publishing, TechOps, and NPR One teams</li>\n<li>Modernized API test suite with modular architecture, adding coverage for new endpoints and improving maintainability</li>\n</ul>\n<p>---</p>\n<h3>QA Automation Manager</h3>\n<div class=\"companyline\"><strong>American Public University System</strong></div>\n<p>Charles Town, WV 03/2012 – 05/2014</p>\n<p>American Public University System (APUS) is an online university system with its headquarters in Charles Town, West Virginia.</p>\n<ul>\n<li>Designed full-stack test automation architecture in .NET / C#: keyword-driven UI framework (Coded UI + Selenium) plus data-driven back-end framework verifying student registration and payment transactions</li>\n<li>Built QA Automation team from ground up: led recruiting for engineer and specialist roles, trained team members in automation tools, development practices, and organizational processes</li>\n<li>Established Agile test management workflow using HP ALM / Quality Center for workload planning and execution tracking</li>\n<li>Drove automation adoption organization-wide through stakeholder engagement and active participation in design, requirements, and test plan reviews</li>\n</ul>\n<p>---</p>\n<h3>Lead QA Analyst</h3>\n<div class=\"companyline\"><strong>FINRA</strong></div>\n<p>Rockville, MD 09/2003 – 03/2012</p>\n<p>FINRA enables investors and firms to participate in the market with confidence by safeguarding its integrity.</p>\n<ul>\n<li>Ensured quality of critical securities industry infrastructure: Web CRD (central licensing system for U.S. securities industry) and IAPD, supporting regulatory compliance throughout 9-year tenure</li>\n<li>Evolved test automation platform from WinRunner to QTP, architecting improved dependency management for multi-application, multi-release, multi-environment testing</li>\n<li>Designed no-code test framework (QTP / VBScript + Excel parameterization) enabling manual testers to create and execute automated tests without programming knowledge</li>\n<li>Pioneered CI adoption: implemented automated test execution pipeline using CruiseControl → Hudson with Ant scripting</li>\n<li>Established requirements-based automation process with HP Quality Center for traceability, test organization, and defect management</li>\n</ul>\n<p>---</p>\n<h3>Test Automation Specialist</h3>\n<div class=\"companyline\"><strong>Fannie Mae</strong></div>\n<p>Washington, DC 09/2002 – 09/2003</p>\n<p>Fannie Mae was chartered by U.S. Congress in 1938 to provide a reliable source of affordable mortgage financing across the country.</p>\n<ul>\n<li>Tested critical mortgage processing applications for federal housing finance agency</li>\n<li>Built WinRunner test automation framework with reusable business action functions; developed LoadRunner scripts for internal and hosted virtual user (HVU) performance testing</li>\n<li>Administered TestDirector server and managed test infrastructure including requirements traceability and defect coordination</li>\n</ul>\n<p>---</p>\n<h3>Test Automation Specialist</h3>\n<div class=\"companyline\"><strong>MedContrax</strong></div>\n<p>Gaithersburg, MD 01/2001 – 02/2002</p>\n<p>MedContrax was a software company based in Rockville, Maryland, providing data processing and integration services to the healthcare industry.</p>\n<ul>\n<li>Tested pharmaceutical contract management application (ColdFusion / SQL Server) for healthcare data processing company</li>\n<li>Developed WinRunner automation framework with reusable function library enabling rapid test development</li>\n<li>Owned full QC environment: Windows NT Server, SQL Server, IIS, ColdFusion, TestDirector administration, and defect coordination</li>\n</ul>\n<p>---</p>\n<h3>Test Automation Specialist</h3>\n<div class=\"companyline\"><strong>US Census Bureau</strong></div>\n<p>Suitland, MD 09/1998 – 01/2001</p>\n<p>The Census Bureau&#39;s mission is to serve as the nation&#39;s leading provider of quality data about its people and economy.</p>\n<ul>\n<li>Managed automated testing of federal data collection applications using Mercury Interactive TestSuite (WinRunner, LoadRunner, TestDirector)</li>\n<li>Conducted performance test engineering: identified key transactions, developed LoadRunner scripts, executed performance scenarios</li>\n<li>Built interactive test results intranet site (Windows 2000 Server/IIS) - early web development for test visibility</li>\n<li>Delivered Y2K compliance testing for critical government systems under federal deadline pressure</li>\n</ul>\n<p>---</p>", "items": []}, {"title": "Education", "kind": "text", "html": "<p><strong>Towson University</strong> - English Studies Coursework completed 1992–1994 | Towson, MD</p>\n<p><strong>Harford Community College</strong> - Business Management Coursework completed 1990–1991 | Churchville, MD</p>\n<p>---</p>", "items": []}, {"title": "Skills", "kind": "text", "html": "<div class=\"companyline\"><strong>Core Expertise</strong></div>\n<p>AI-Assisted QA Workflows | Test Automation Architecture | Software Development | QA Team Leadership | Performance Testing | CI/CD Integration | Test Strategy</p>\n<div class=\"companyline\"><strong>Languages</strong></div>\n<p>JavaScript, Ruby, Python, C#/.NET, Java, PowerShell, SQL</p>\n<div class=\"companyline\"><strong>Test Automation</strong></div>\n<p>Selenium, Playwright, Nightwatch.js, Appium, JMeter, Gatling, RSpec</p>\n<div class=\"companyline\"><strong>DevOps &amp; Cloud</strong></div>\n<p>Jenkins, Azure Pipelines, AWS, Git, GitHub, Docker, Grafana</p>\n<div class=\"companyline\"><strong>AI Tools</strong></div>\n<p>GitHub Copilot, Cursor, Claude, ChatGPT, Codex, Cline, Ollama, LM Studio, Jan</p>\n<div class=\"companyline\"><strong>Practices</strong></div>\n<p>Agile / Scrum, Test-Driven Development, API Testing, Cross-Platform Testing</p>", "items": []}]};
const CONFIG = {"meta": {"generator": "resume-cleanroom", "version": "1.1"}, "ui": {"defaultTheme": "system", "enableThemeToggle": true, "enableSearch": true, "enableNav": true, "enableViewToggle": true, "defaultView": "short", "rememberView": true, "rememberTheme": true, "collapseCompanyDescriptionsByDefault": true, "smoothScroll": true}, "shortView": {"workExperience": {"jobsToKeep": 3, "bulletsPerJob": 3, "keepRoleHeadings": true, "keepCompanyLine": true, "keepDatesLine": true}, "sections": {"include": ["Summary", "Work Experience", "Skills", "Education", "Links"], "exclude": []}, "earlierExperience": {"enabled": true, "label": "Earlier Experience", "format": "inline", "maxCompanies": 8}}, "search": {"minQueryLength": 2, "highlightMatches": true, "fields": ["Summary", "Work Experience", "Skills", "Education"]}, "accessibility": {"reduceMotionRespectsPreference": true, "focusVisible": true, "skipLink": true}};

/** ====== Helpers ====== */
const $ = (sel, el=document) => el.querySelector(sel);
const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
const prefersReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

function slugify(s){
  return (s||'')
    .toLowerCase()
    .replace(/&/g,'and')
    .replace(/[^a-z0-9]+/g,'-')
    .replace(/(^-|-$)/g,'');
}

function setTheme(theme){
  // theme: 'light' | 'dark' | 'system'
  const root = document.documentElement;
  if(theme === 'system'){
    root.removeAttribute('data-theme');
  }else{
    root.setAttribute('data-theme', theme);
  }
  if(CONFIG.ui.rememberTheme){
    localStorage.setItem('resume_theme', theme);
  }
  syncThemeButtons(theme);
}

function getSystemTheme(){
  const dark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  return dark ? 'dark' : 'light';
}

function getInitialTheme(){
  const saved = CONFIG.ui.rememberTheme ? localStorage.getItem('resume_theme') : null;
  return saved || CONFIG.ui.defaultTheme || 'system';
}

function toggleTheme(){
  const cur = document.documentElement.getAttribute('data-theme') || 'system';
  // Cycle: system -> dark -> light -> system
  const next = (cur === 'system') ? 'dark' : (cur === 'dark' ? 'light' : 'system');
  setTheme(next);
}

function syncThemeButtons(theme){
  const label = theme === 'system' ? `Theme: Auto` : `Theme: ${theme[0].toUpperCase()+theme.slice(1)}`;
  const pressed = theme !== 'system';
  const btns = [$('#themeBtn'), $('#themeBtnMobile')].filter(Boolean);
  btns.forEach(b => { b.textContent = label; b.setAttribute('aria-pressed', pressed ? 'true' : 'false'); });
}

function setView(view){
  // view: 'short' | 'full'
  if(CONFIG.ui.rememberView){
    localStorage.setItem('resume_view', view);
  }
  renderWithTransition(view);
  syncViewButton(view);
}

function getInitialView(){
  const saved = CONFIG.ui.rememberView ? localStorage.getItem('resume_view') : null;
  return saved || CONFIG.ui.defaultView || 'short';
}

function syncViewButton(view){
  const btn = $('#viewBtn');
  if(!btn) return;
  const label = (view === 'short') ? 'Content: Short' : 'Content: Full';
  btn.textContent = label;
  btn.setAttribute('aria-pressed', 'true');
}

function scrollHome(){
  window.scrollTo({ top: 0, behavior: (CONFIG.ui.smoothScroll && !prefersReducedMotion) ? 'smooth' : 'auto' });
  const content = $('#content');
  if(content) content.focus({ preventScroll: true });
}

function escapeHtml(s){
  return (s||'')
    .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
    .replaceAll('"','&quot;').replaceAll("'",'&#39;');
}

function buildPageHeader(model){
  const name = escapeHtml(model.name || '');
  const location = escapeHtml(model.location || '');
  const email = escapeHtml(model.email || '');

  const contactParts = [];
  if(location) contactParts.push(`<span>${location}</span>`);
  if(email) contactParts.push(`<a href="mailto:${email}">${email}</a>`);

  return `
    <section class="card headcard" aria-labelledby="resumeName">
      <div class="headgrid">
        <div>
          <h1 id="resumeName" class="h1">${name}</h1>
          <div class="contact" aria-label="Contact information">${contactParts.join('<span class="dot" aria-hidden="true">•</span>')}</div>
        </div>
      </div>
    </section>
  `;
}


function highlight(text, q){
  if(!CONFIG.search.highlightMatches || !q || q.length < (CONFIG.search.minQueryLength||2)) return escapeHtml(text);
  const re = new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'ig');
  return escapeHtml(text).replace(re, '<mark>$1</mark>');
}

/** ====== Short view derivation ====== */
function buildShortModel(full){
  const out = JSON.parse(JSON.stringify(full)); // deep copy
  // Determine which sections to include
  const include = new Set((CONFIG.shortView.sections.include||[]).map(s => s.toLowerCase()));
  const exclude = new Set((CONFIG.shortView.sections.exclude||[]).map(s => s.toLowerCase()));
  out.sections = out.sections.filter(sec => {
    const name = (sec.title||'').toLowerCase();
    if(exclude.has(name)) return false;
    if(include.size && !include.has(name)) return false;
    return true;
  });

  // Work Experience trimming
  const we = out.sections.find(s => (s.title||'').toLowerCase() === 'work experience');
  if(we && Array.isArray(we.items)){
    const keepN = CONFIG.shortView.workExperience.jobsToKeep ?? 3;
    const keepB = CONFIG.shortView.workExperience.bulletsPerJob ?? 3;
    const kept = we.items.slice(0, keepN).map(job => {
      const j = {...job};
      if(Array.isArray(j.bullets)) j.bullets = j.bullets.slice(0, keepB);
      return j;
    });
    const dropped = we.items.slice(keepN);
    we.items = kept;

    if(CONFIG.shortView.earlierExperience?.enabled && dropped.length){
      const companies = dropped.map(d => d.company).filter(Boolean);
      const uniq = Array.from(new Set(companies));
      const maxC = CONFIG.shortView.earlierExperience.maxCompanies ?? 8;
      const shown = uniq.slice(0, maxC);
      const more = uniq.length > maxC ? ` +${uniq.length - maxC} more` : '';
      const label = CONFIG.shortView.earlierExperience.label || 'Earlier Experience';

      we.items.push({
        kind: 'earlier',
        role: label,
        company: shown.join(' • ') + more,
        location: '',
        dates: '',
        description: '',
        bullets: []
      });
    }
  }

  return out;
}

/** ====== Rendering ====== */
function render(model){
  // Sidebar title (keep minimal; main header shows full contact)
  $('#brandName').textContent = (CONFIG?.ui?.sidebarTitle) || 'Navigation';

  
  // Main page header (name + contact)
  $('#pageHead').innerHTML = buildPageHeader(model);

// Build sections + ids
  const sections = model.sections.map(sec => ({...sec, id: slugify(sec.title)}));

  // Nav
  if(CONFIG.ui.enableNav){
    const nav = $('#navLinks');
    nav.innerHTML = '';
    // Add Home link first
    const homeLink = document.createElement('a');
    homeLink.href = '#';
    homeLink.innerHTML = `<span>Home</span>`;
    homeLink.addEventListener('click', (e) => {
      e.preventDefault();
      scrollHome();
    });
    nav.appendChild(homeLink);
    // Then add section links
    sections.forEach(sec => {
      const a = document.createElement('a');
      a.href = `#${sec.id}`;
      a.innerHTML = `<span>${escapeHtml(sec.title)}</span>`;
      a.addEventListener('click', (e) => {
        // Let anchor work, but adjust focus after.
        setTimeout(() => {
          const el = document.getElementById(sec.id);
          if(el) el.focus({preventScroll:true});
        }, 0);
      });
      nav.appendChild(a);
    });
  }else{
    const nav = $('#navLinks');
    if(nav) nav.innerHTML = '';
  }

  // Mobile drawer
  const drawer = $('#mobileDrawer');
  drawer.innerHTML = '';
  const m = document.createElement('div');
  m.className = 'brand';
  m.style.boxShadow = 'none';
  m.style.border = '1px solid var(--border)';
  m.style.background = 'var(--card)';
  m.innerHTML = `
    <div class="name">${escapeHtml(model.name||'')}</div>
    <div class="meta">${escapeHtml([model.location, model.email].filter(Boolean).join(' · '))}</div>
    <div class="navlinks" id="mNav"></div>
  `;
  drawer.appendChild(m);
  const mNav = $('#mNav', drawer);
  if(CONFIG.ui.enableNav){
    // Add Home link first
    const homeLink = document.createElement('a');
    homeLink.href = '#';
    homeLink.innerHTML = `<span>Home</span>`;
    homeLink.addEventListener('click', (e) => {
      e.preventDefault();
      scrollHome();
      closeMobileDrawer();
    });
    mNav.appendChild(homeLink);
    // Then add section links
    sections.forEach(sec => {
      const a = document.createElement('a');
      a.href = `#${sec.id}`;
      a.innerHTML = `<span>${escapeHtml(sec.title)}</span>`;
      a.addEventListener('click', () => closeMobileDrawer());
      mNav.appendChild(a);
    });
  }

  // Content
  const panel = $('#viewPanel');
  panel.innerHTML = '';

  // Sections
  sections.forEach(sec => {
    const sEl = document.createElement('section');
    sEl.id = sec.id;
    sEl.tabIndex = -1;
    sEl.innerHTML = `<h2>${escapeHtml(sec.title)}</h2>`;
    if(sec.kind === 'text'){
      sEl.innerHTML += sec.html || '';
    }else if(sec.kind === 'work'){
      (sec.items||[]).forEach(job => {
        const card = document.createElement('div');
        card.className = 'card';
        const title = job.kind === 'earlier' ? escapeHtml(job.role||'Earlier Experience')
          : `${escapeHtml(job.role||'')}`;
        const company = escapeHtml(job.company||'');
        const loc = escapeHtml(job.location||'');
        const dates = escapeHtml(job.dates||'');
        const desc = job.description ? `<details ${CONFIG.ui.collapseCompanyDescriptionsByDefault ? '' : 'open'}>
            <summary>About ${company || 'this company'}</summary>
            <p class="small">${escapeHtml(job.description)}</p>
          </details>` : '';
        const bullets = (job.bullets||[]).length ? `<ul>${job.bullets.map(b => `<li>${b}</li>`).join('')}</ul>` : '';
        card.innerHTML = `
          <div class="row">
            <div>
              <div style="font-weight:850">${title}</div>
              <div class="small">${company}${(loc||dates) ? ` · ${loc}${(loc&&dates)?' · ':''}${dates}` : ''}</div>
            </div>
          </div>
          ${desc}
          ${bullets}
        `;
        sEl.appendChild(card);
        sEl.appendChild(document.createElement('div')).style.height = '10px';
      });
    }
    panel.appendChild(sEl);
  });

  // Setup intersection observer for aria-current
  if(CONFIG.ui.enableNav){
    const links = $$('#navLinks a');
    const map = new Map(links.map(a => [a.getAttribute('href').slice(1), a]));
    const obs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        const id = e.target.id;
        const a = map.get(id);
        if(!a) return;
        if(e.isIntersecting){
          links.forEach(x => x.setAttribute('aria-current','false'));
          a.setAttribute('aria-current','true');
        }
      });
    }, { rootMargin: '-30% 0px -60% 0px', threshold: 0.01 });
    sections.forEach(sec => {
      const el = document.getElementById(sec.id);
      if(el) obs.observe(el);
    });
  }
}

function renderWithTransition(view){
  const panel = $('#viewPanel');
  const current = panel;
  // exit
  current.classList.add('exit');
  const doRender = () => {
    current.classList.remove('exit');
    current.classList.add('enter');
    const model = (view === 'short') ? buildShortModel(RESUME) : RESUME;
    render(model);
    // enter
    requestAnimationFrame(() => {
      current.classList.add('active');
      setTimeout(() => {
        current.classList.remove('enter','active');
      }, prefersReducedMotion ? 0 : 240);
    });
  };
  setTimeout(doRender, prefersReducedMotion ? 0 : 180);
}

/** ====== Search ====== */
function applySearch(q){
  const query = (q||'').trim();
  // If empty, re-render current view cleanly
  const view = getInitialView();
  const model = (view === 'short') ? buildShortModel(RESUME) : RESUME;
  render(model);
  if(!query || query.length < (CONFIG.search.minQueryLength||2)) return;

  const haySections = new Set((CONFIG.search.fields||[]).map(s => s.toLowerCase()));
  const panel = $('#viewPanel');
  // Highlight and filter cards based on text match
  const cards = $$('.card', panel);
  const lowerQ = query.toLowerCase();
  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    const match = text.includes(lowerQ);
    card.style.display = match ? '' : 'none';
    if(match && CONFIG.search.highlightMatches){
      // highlight within bullet list + small text + headings
      // naive: replace text nodes inside card for a few known elements
      $$('li, .small, div[style*="font-weight"]', card).forEach(el => {
        el.innerHTML = highlight(el.textContent, query);
      });
    }
  });

  // Also hide sections that have no visible cards
  $$('#viewPanel > section', panel).forEach(sec => {
    const hasVisibleCard = $$('.card', sec).some(c => c.style.display !== 'none');
    // If section contains no cards (like Summary text), keep it unless excluded by fields rule
    const title = $('h2', sec)?.textContent?.toLowerCase() || '';
    const isCardSection = $$('.card', sec).length > 0;
    if(isCardSection){
      sec.style.display = hasVisibleCard ? '' : 'none';
    }else{
      sec.style.display = haySections.size && !haySections.has(title) ? '' : '';
    }
  });
}

/** ====== Mobile drawer ====== */
function openMobileDrawer(){
  const btn = $('#mobileMenuBtn');
  const drawer = $('#mobileDrawer');
  drawer.classList.add('open');
  btn.setAttribute('aria-expanded','true');
}
function closeMobileDrawer(){
  const btn = $('#mobileMenuBtn');
  const drawer = $('#mobileDrawer');
  drawer.classList.remove('open');
  btn.setAttribute('aria-expanded','false');
}
function toggleMobileDrawer(){
  const drawer = $('#mobileDrawer');
  drawer.classList.contains('open') ? closeMobileDrawer() : openMobileDrawer();
}

/** ====== Wire up ====== */
(function init(){
  // Theme
  const initialTheme = getInitialTheme();
  setTheme(initialTheme);

  // UI toggles
  if(!CONFIG.ui.enableThemeToggle){
    ['#themeBtn','#themeBtnMobile'].forEach(id => { const el=$(id); if(el) el.style.display='none'; });
  }
  if(!CONFIG.ui.enableSearch){
    const sw = $('#searchWrap'); if(sw) sw.style.display='none';
  }
  if(!CONFIG.ui.enableViewToggle){
    const vb = $('#viewBtn'); if(vb) vb.style.display='none';
  }

  // View
  const initialView = getInitialView();
  syncViewButton(initialView);
  render((initialView === 'short') ? buildShortModel(RESUME) : RESUME);

  // Buttons
  $('#themeBtn')?.addEventListener('click', toggleTheme);
  $('#themeBtnMobile')?.addEventListener('click', toggleTheme);
  $('#printBtn')?.addEventListener('click', () => window.print());
  $('#viewBtn')?.addEventListener('click', () => {
    const cur = getInitialView();
    setView(cur === 'short' ? 'full' : 'short');
  });

  // Search
  const si = $('#searchInput');
  si?.addEventListener('input', () => applySearch(si.value));

  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if(e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey){
      if(CONFIG.ui.enableSearch){
        e.preventDefault();
        $('#searchInput')?.focus();
      }
    }
    if(e.key.toLowerCase() === 'p' && (e.ctrlKey || e.metaKey)){
      // let browser print
      return;
    }
    if(e.key.toLowerCase() === 'p' && !e.ctrlKey && !e.metaKey && !e.altKey){
      e.preventDefault(); window.print();
    }
    if(e.key.toLowerCase() === 'h' && !e.ctrlKey && !e.metaKey && !e.altKey){
      e.preventDefault(); scrollHome();
    }
  });

  // Mobile menu
  $('#mobileMenuBtn')?.addEventListener('click', toggleMobileDrawer);
})();
</script>
</body>
</html>
